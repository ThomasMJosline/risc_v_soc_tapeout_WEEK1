# Day 2

## 1. Understanding .lib file

### **1. Timing libraries**
The .lib file here corresponds to the Process Design Kit (PDK) used in the program. The PDK used here is the SKY130 PDK which is an open-source PDK based SkyWater Technology's 130 nm CMOS technology. These files contain the all standard cells used to realize our complex designs, along with other specs such as power consumption, area, timing etc.  

### **2. Undertanding the library filename**
The three important parameters regarding a device are:
 - Process
 - Voltage
 - Temperature
   
The .lib files are prepared for different cases of the above parameter. In our case the library used is: 
 ### sky130_fd_sc_hd__tt_025C_1v80.lib 
 
Here the "tt_025c_1v80" part indicates the process, temperature and voltage parameters:
 -

### **3. Testbench**
Testbench is a file that is used to supply a set of input values to the design with whatever timings as we want observe. Testbench file together with the Simulator is used to verify the functionality of the design. In this RISC-V SoC tapeout program, the simulatior used wil be Icarus Verilog, which is an open source simulator.

## 2. Iverilog based simulation flow
Design and testbench is provided to the iverilog simulatior. A .vcd (Value Change Dump) file is generated by the iverlog simulator. The .vcd file can be used to observe the associated waveforms using gtkwave.

<img src="images/flow.png" alt="Alt Text" width="500"/>


## 3. Simulating a 2 to 1 Multiplexer

Step 1. Go to the directory with the testbench and design files:
```
$ cd vsd_risc_v_prog/sky130RTLDesignAndSynthesisWorkshop/verilog_files
```
Step 2. Compile the design and testbench:
```
$ iverilog  good_mux.v tb_good_mux.v
```
Step 3. Run the simulation:
```
$ ./a.out
```
Step 4. Observe the waveform in gtkwave:
```
$ gtkwave tb_good_mux.vcd
```
Observing waveform through gtkwave
![Alt Text](images/gtkwave_goodmux.png)

## 4. Introduction to Yosys & Gate Libraries

 - Used to convert RTL to netlist (which is the design implemented as collection of standard cells).

### What is .lib file?
 - Collection of basic logical modules, which are the standard cells (AND, OR, NOR...).
 - Different versions of same logical module:
     Each of these versions differ in speed, area, power comsumption etc. While some versions are used in order to make hardware that operates at higher frequency (at the cost of area and power consumption), the slower versions are necessary in cases where area or power consumption are the bottleneck.


## .5 Synthesizing design with Yosys

Step 1. Invoke Yosys (I invoked yosys from the directory where the verilog files are present):
```
$ yosys                  
```
Step 2. Read the liberty library (have to give path to the library files, relative or absolute):
```
$ read_liberty -lib ../lib/sky130_fd_sc_hd__tt_025C_1v80.lib
```
Step 3. Read the verilog code (as I am already in the directory where verilog modules are present, no adding any path):
```
$ read_verilog good_mux.v
```
Step 4. Synthesize the design ( we are synthesizing the top module which is "good_mux"):
```
$ synth -top good_mux
```

Step 5. Generating the netlist:
```
$ abc -liberty ../lib/sky130_fd_sc_hd__tt_025C_1v80.lib
```
The standard cell used to make the netlist can be seen:
![Alt Text](images/abc_liberty.png)

Step 6. To view the netlist:
```
$ show
```
The generated netlist:
![Alt Text](images/netlist.png)

Step 7. Writing the netlist:
```
$ write_verilog -noattr good_mux_netlist.v
```
This will generate the verilog code for the same "good_mux.v" module, but in terms of standard cell from the library. The generated .v file:
```
/* Generated by Yosys 0.57+153 (git sha1 6b3a7e244, g++ 11.4.0-1ubuntu1~22.04.2 -fPIC -O3) */

module good_mux(i0, i1, sel, y);
  input i0;
  wire i0;
  input i1;
  wire i1;
  input sel;
  wire sel;
  output y;
  wire y;
  wire _0_;
  wire _1_;
  wire _2_;
  wire _3_;
  sky130_fd_sc_hd__mux2_1 _4_ (
    .A0(_0_),
    .A1(_1_),
    .S(_2_),
    .X(_3_)
  );
  assign _0_ = i0;
  assign _1_ = i1;
  assign _2_ = sel;
  assign y = _3_;
endmodule

```
